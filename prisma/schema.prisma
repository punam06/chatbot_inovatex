// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// ============================================================================
// USER MODEL
// ============================================================================
// Represents a user of the Food Management System
// Stores authentication data, preferences, and profile information
model User {
  id                    Int                   @id @default(autoincrement())
  email                 String                @unique @db.VarChar(255)
  passwordHash          String                @db.VarChar(255)
  fullName              String                @db.VarChar(255)
  householdSize         Int                   @default(1)
  
  // JSON field for dietary preferences - stores array like ["Vegetarian", "Vegan"]
  // Critical for flexibility as user preferences may vary
  dietaryPreferences    Json                  @default("[]")
  
  location              String?               @db.VarChar(255)
  
  createdAt             DateTime              @default(now())
  updatedAt             DateTime              @updatedAt
  
  // Relations
  inventories           Inventory[]
  consumptionLogs       ConsumptionLog[]
  
  @@map("users")
}

// ============================================================================
// FOOD ITEM MODEL
// ============================================================================
// Global seed data representing standard food items
// Used as reference for inventory management
model FoodItem {
  id                    Int                   @id @default(autoincrement())
  name                  String                @unique @db.VarChar(255)
  category              String                @db.VarChar(100) // e.g., 'Dairy', 'Vegetables', 'Fruits', 'Grains', 'Proteins'
  defaultExpirationDays Int                   // e.g., Milk: 7, Rice: 365
  averageCost           Decimal               @db.Decimal(10, 2) // Cost per unit
  unit                  String                @db.VarChar(50) // e.g., 'kg', 'liter', 'pieces', 'grams'
  
  createdAt             DateTime              @default(now())
  updatedAt             DateTime              @updatedAt
  
  // Relations
  inventories           Inventory[]
  
  @@map("food_items")
}

// ============================================================================
// INVENTORY MODEL
// ============================================================================
// User-specific food inventory
// Tracks what users have, quantities, and expiration information
model Inventory {
  id                    Int                   @id @default(autoincrement())
  userId                Int
  foodItemId            Int?                  // Optional: Link to global FoodItem
  
  customName            String                @db.VarChar(255) // User's custom name for the item
  quantity              Decimal               @db.Decimal(10, 2)
  unit                  String                @db.VarChar(50)
  
  purchaseDate          DateTime
  expirationDate        DateTime?             // Nullable - some items don't expire
  
  sourceImageUrl        String?               @db.Text // URL to uploaded receipt or food image for CV processing
  
  // JSON field for AI-extracted metadata from future CV scans
  // May contain: ripeness level, brand name, quality score, detected allergens, etc.
  aiMetadata            Json                  @default("{}")
  
  createdAt             DateTime              @default(now())
  updatedAt             DateTime              @updatedAt
  
  // Relations
  user                  User                  @relation(fields: [userId], references: [id], onDelete: Cascade)
  foodItem              FoodItem?             @relation(fields: [foodItemId], references: [id], onDelete: SetNull)
  
  // Indexes for performance
  @@index([userId])
  @@index([expirationDate]) // Critical for expiring items query
  @@index([foodItemId])
  @@map("inventories")
}

// ============================================================================
// CONSUMPTION LOG MODEL
// ============================================================================
// Training data for future AI predictions and waste analysis
// Records all food-related actions (purchased, consumed, wasted, donated)
model ConsumptionLog {
  id                    Int                   @id @default(autoincrement())
  userId                Int
  
  foodName              String                @db.VarChar(255) // Snapshot of name at time of action
  actionType            ActionType            // PURCHASED, CONSUMED, WASTED, DONATED
  quantity              Decimal               @db.Decimal(10, 2)
  
  reasonForWaste        String?               @db.Text // Optional: Why was it wasted/donated?
  
  logDate               DateTime              @default(now())
  
  // Relations
  user                  User                  @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // Indexes for performance
  @@index([userId])
  @@index([logDate])
  @@index([actionType])
  @@map("consumption_logs")
}

// ============================================================================
// RESOURCE MODEL
// ============================================================================
// Static resources (tips, articles, videos) for sustainability education
model Resource {
  id                    Int                   @id @default(autoincrement())
  title                 String                @db.VarChar(255)
  content               String                @db.Text
  categoryTag           String                @db.VarChar(100) // e.g., 'Dairy', 'Vegetables', 'Storage Tips', 'Recipes'
  resourceType          ResourceType          // TIP, ARTICLE, VIDEO
  
  createdAt             DateTime              @default(now())
  updatedAt             DateTime              @updatedAt
  
  @@map("resources")
}

// ============================================================================
// ENUMS
// ============================================================================

enum ActionType {
  PURCHASED
  CONSUMED
  WASTED
  DONATED
}

enum ResourceType {
  TIP
  ARTICLE
  VIDEO
}
